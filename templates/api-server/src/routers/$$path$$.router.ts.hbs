// This file is automatically generated and should not be edited.
import { Router, Response, NextFunction } from 'express'
import { IRequest } from '../interfaces'
import * as ApiInterfaces from '../interfaces/api'

import {
{{#each operation}}
  {{#each this.path}}
    {{#validMethod @key}}
  {{funcOperation ../operationId}},
    {{/validMethod}}
  {{/each}}
{{/each}}
} from '../controllers/{{operation_name}}'

import {
{{#each operation}}
  {{#each this.path}}
    {{#validMethod @key}}
  validate{{formatOperation ../operationId}}Params,
{{/validMethod}}
  {{/each}}
{{/each}}
} from './validators/{{operation_name}}.validator'

const router = Router()

{{#each operation}}
    {{#each this.path}}
        {{#validMethod @key}}
/**
{{#if ../description}}
 * {{{docComment ../description}}}
{{/if}}
{{#each ../parameters}}
 * @param {{schema.type}} {{#unless required}}[{{/unless}}{{name}}{{#unless required}}]{{/unless}} {{{description}}}
{{/each}}
 */
router.{{@key}}('{{../../subresource}}', async (req: IRequest, res: Response, next: NextFunction) => {
  const params : ApiInterfaces.{{paramOperation ../operationId}} = {
{{#if ../requestBody}}
  {{> reqParams ../requestBody }}
{{/if}}

{{#each ../parameters}}
  {{#equal this.in "query"}}
    {{{formatVar ../name}}}: {{{handleParam (tsType ../schema.type ../schema) ../name "req.query."}}} as unknown as {{{tsType ../schema.type ../schema}}},
  {{/equal}}
  {{#equal this.in "path"}}
    {{{formatVar ../name}}}: {{{handleParam (tsType ../schema.type ../schema) ../name "req.params."}}}  as unknown as {{{tsType ../schema.type ../schema}}},
  {{/equal}}
  {{#match @../key "(post|put)"}}
    {{#equal ../in "body"}}
    {{{formatVar ../name}}}: {{{handleParam (tsType ../schema.type ../schema) ../name "req.body."}}} as unknown as {{{tsType ../schema.type ../schema}}},
    {{/equal}}
  {{/match}}
{{/each}}
  }

  try {
    validate{{formatOperation ../operationId}}Params(params)

    const result = await {{funcOperation ../operationId}}(req.context, params)
  {{#ifNoSuccessResponses ../responses}}
    delete result.status

    res.status(200).send(result)
  {{else}}
    res.status(result.status || 200)

    delete result.status

    res.send(result)
  {{/ifNoSuccessResponses}}
  } catch (err) {
    next(err)
  }
})
        {{/validMethod}}
    {{/each}}
{{/each}}

export default router
